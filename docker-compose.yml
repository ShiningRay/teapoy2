rails: &rails
  image: shiningray/teapoy2
  environment:
    RAILS_ENV: production
    REDIS_URL: redis://redis
  links:
    - mysql
    - mongodb
    - redis
    - memcached
  working_dir: /app

mysql:
  image: mariadb:10.0
  environment:
    MYSQL_DATABASE: teapoy2
    MYSQL_USER: teapoy
    MYSQL_PASSWORD: teapoy
    MYSQL_ROOT_PASSWORD: dockerimage
  volumes:
    - /data/mysql:/var/lib/mysql
mongodb:
  image: mongo:3.0
  volumes:
    - /data/mongo:/data/db
redis:
  image: redis:3.0
  volumes:
    - /data/redis:/data
memcached:
  image: memcached:1.4
scheduler:
  <<: *rails
mailman:
  <<: *rails
sidekiq:
  <<: *rails
puma:
  <<: *rails
  expose:
    - 3001:3000
railsdev:
  <<: *rails
  volumes:
    - .:/app

nginx:
  image: nginx
  links:
    - scheduler
    - mailman
    - puma
  expose:
    - 80
    - 443
